<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        Lab 3 - Data Retrieval with Cypher - CodiMD
    </title>
    <link rel="icon" type="image/png" href="http://localhost:3000/favicon.png">
    <link rel="apple-touch-icon" href="http://localhost:3000/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.0/css/bootstrap.min.css" integrity="sha256-H0KfTigpUV+0/5tn2HXC0CPwhhDhWgSawJdnFd0CGCo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fork-awesome/1.1.3/css/fork-awesome.min.css" integrity="sha256-ZhApazu+kejqTYhMF+1DzNKjIzP7KXu6AzyXcC1gMus=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,600,600italic,300italic,300|Source+Serif+Pro|Source+Code+Pro:400,300,500&subset=latin,latin-ext);.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{padding:0 1em;color:#777;border-left:.25em solid #ddd}.night .markdown-body blockquote{color:#bcbcbc}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.night .markdown-body h1,.night .markdown-body h2,.night .markdown-body h3,.night .markdown-body h4,.night .markdown-body h5,.night .markdown-body h6{color:#ddd}.markdown-body h1 .fa-link,.markdown-body h2 .fa-link,.markdown-body h3 .fa-link,.markdown-body h4 .fa-link,.markdown-body h5 .fa-link,.markdown-body h6 .fa-link{color:#000;vertical-align:middle;visibility:hidden;font-size:16px}.night .markdown-body h1 .fa-link,.night .markdown-body h2 .fa-link,.night .markdown-body h3 .fa-link,.night .markdown-body h4 .fa-link,.night .markdown-body h5 .fa-link,.night .markdown-body h6 .fa-link{color:#fff}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .fa-link,.markdown-body h2:hover .anchor .fa-link,.markdown-body h3:hover .anchor .fa-link,.markdown-body h4:hover .anchor .fa-link,.markdown-body h5:hover .anchor .fa-link,.markdown-body h6:hover .anchor .fa-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.night .markdown-body table tr{background-color:#5f5f5f}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.night .markdown-body table tr:nth-child(2n){background-color:#4f4f4f}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:.2em 0;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.night .markdown-body code,.night .markdown-body tt{color:#eee;background-color:hsla(0,0%,90.2%,.36)}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\A0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.markdown-body kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important}.markdown-body pre{border:inherit!important}.night .markdown-body pre{filter:invert(100%)}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-webkit-inline-flex;display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.night .markdown-body .gist table tr:nth-child(2n){background-color:#ddd}.markdown-body code[data-gist-id]{background:none;padding:0;filter:invert(100%)}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.geo,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{text-align:center;background-color:inherit;border-radius:0;white-space:inherit}.night .markdown-body pre.graphviz .graph>polygon{fill:#333}.night .markdown-body pre.mermaid .sectionTitle,.night .markdown-body pre.mermaid .titleText,.night .markdown-body pre.mermaid text{fill:#fff}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{max-width:100%;height:100%}.night .markdown-body .abc path{fill:#eee}.night .markdown-body .abc path.note_selected{fill:##4DD0E1}.night tspan{fill:#fefefe}.night pre rect{fill:transparent}.night pre.flow-chart path,.night pre.flow-chart rect{stroke:#fff}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p,.markdown-body .alert>ul{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body img{background-color:transparent}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;-webkit-transition:opacity .2s;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;-webkit-transition:opacity .2s;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.geo-map{width:100%;height:250px}.markmap-container{height:300px}.markmap-container>svg{width:100%;height:100%}.MJX_Assistive_MathML{display:none}.ui-infobar{position:relative;z-index:2;max-width:758px;margin-top:25px;margin-bottom:-25px;color:#777}.toc .invisable-node{list-style-type:none}.ui-toc{position:fixed;bottom:20px;z-index:10000}.ui-toc-label{opacity:.9;background-color:#ccc;border:none}.ui-toc-label,.ui-toc .open .ui-toc-label{-webkit-transition:opacity .2s;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#5f5f5f}.ui-toc-label:focus{opacity:1;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;-webkit-transition:opacity .2s;transition:opacity .2s}.ui-toc-dropdown{margin-top:23px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.night .ui-toc-dropdown .nav>li>a:focus,.night .ui-toc-dropdown .nav>li>a:hover{color:#fff;border-left-color:#fff}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.night .ui-toc-dropdown .nav>.active:focus>a,.night .ui-toc-dropdown .nav>.active:hover>a,.night .ui-toc-dropdown .nav>.active>a{color:#fff;border-left:2px solid #fff}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.night .ui-toc-dropdown .nav>li>a{color:#aaa}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:50px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>a{padding-right:50px}.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:60px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>ul>li>a{padding-right:60px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>a:hover{padding-left:49px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>a:hover{padding-right:49px}.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>ul>li>ul>li>a:hover{padding-left:59px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>ul>li>ul>li>a:hover{padding-right:59px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active>a{padding-left:48px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.active>.nav>.nav>.active>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>.nav>.active:hover>a{padding-right:48px}.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active>a{padding-left:58px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.active>.nav>.nav>.active>.nav>.active>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>.nav>.active>.nav>.active:hover>a{padding-right:58px}.markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,Hiragino Kaku Gothic Pro,"\30D2\30E9\30AE\30CE\89D2\30B4   Pro W3",Osaka,Meiryo,"\30E1\30A4\30EA\30AA",MS Gothic,"\FF2D\FF33   \30B4\30B7\30C3\30AF",sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,"\FF2D\FF33   \FF30\30B4\30B7\30C3\30AF",sans-serif}.markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang TC,Microsoft JhengHei,"\5FAE\8EDF\6B63\9ED1",sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,"\5FAE\8EDF\6B63\9ED1UI",sans-serif}.markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang SC,Microsoft YaHei,"\5FAE\8F6F\96C5\9ED1",sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,"\5FAE\8F6F\96C5\9ED1UI",sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:rgba(0,0,0,.85)}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:3px;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:contain}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}small span{line-height:22px}small .dropdown{display:inline-block}small .dropdown a:focus,small .dropdown a:hover{text-decoration:none}.unselectable{-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-o-user-select:none;user-select:none}.night .navbar{background:#333;border-bottom-color:#333;color:#eee}.night .navbar a{color:#eee}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}.focus,:focus{outline:none!important}::-moz-focus-inner{border:0!important}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid" lang="en"><h1 id="Lab-3---Data-Retrieval-with-Cypher"><a class="anchor hidden-xs" href="#Lab-3---Data-Retrieval-with-Cypher" title="Lab-3---Data-Retrieval-with-Cypher"><i class="fa fa-link"></i></a>Lab 3 - Data Retrieval with Cypher</h1><p><strong>Course:</strong> Big Data - IU S24<br>
<strong>Author:</strong> Firas Jolha</p><h2 id="Dataset"><a class="anchor hidden-xs" href="#Dataset" title="Dataset"><i class="fa fa-link"></i></a>Dataset</h2><ul>
<li><a href="https://disk.yandex.ru/d/HlBEEgUJmkD6Xg" target="_blank" rel="noopener">Users and Posts</a></li>
</ul><h2 id="Neo4j-Desktop"><a class="anchor hidden-xs" href="#Neo4j-Desktop" title="Neo4j-Desktop"><i class="fa fa-link"></i></a>Neo4j Desktop</h2><ul>
<li><a href="https://neo4j.com/deployment-center/?desktop-gdb" target="_blank" rel="noopener">Download website</a>
<ul>
<li>Only community edition.</li>
</ul>
</li>
<li>Recommended system requirements:
<ul>
<li>MacOS 10.10 (Yosemite)+</li>
<li>Windows 8.1+ with Powershell 5.0+</li>
<li>Ubuntu 12.04+, Fedora 21, Debian 8</li>
</ul>
</li>
</ul><h1 id="Agenda"><a class="anchor hidden-xs" href="#Agenda" title="Agenda"><i class="fa fa-link"></i></a>Agenda</h1><p></p><div class="toc"><ul>
<li><a href="#Lab-3---Data-Retrieval-with-Cypher" title="Lab 3 - Data Retrieval with Cypher">Lab 3 - Data Retrieval with Cypher</a><ul>
<li><a href="#Dataset" title="Dataset">Dataset</a></li>
<li><a href="#Neo4j-Desktop" title="Neo4j Desktop">Neo4j Desktop</a></li>
</ul>
</li>
<li><a href="#Agenda" title="Agenda">Agenda</a></li>
<li><a href="#Prerequisites" title="Prerequisites">Prerequisites</a></li>
<li><a href="#Objectives" title="Objectives">Objectives</a></li>
<li><a href="#Introduction" title="Introduction">Introduction</a></li>
<li><a href="#Dataset-Descripion" title="Dataset Descripion">Dataset Descripion</a></li>
<li><a href="#Build-the-relational-database" title="Build the relational database">Build the relational database</a><ul>
<li><a href="#Fix-Friends-table" title="Fix Friends table">Fix Friends table</a></li>
</ul>
</li>
<li><a href="#Data-Retrieval-using-SQL" title="Data Retrieval using SQL">Data Retrieval using SQL</a><ul>
<li><a href="#Data-Retrieval-from-a-single-table" title="Data Retrieval from a single table">Data Retrieval from a single table</a></li>
<li><a href="#Data-Retrieval-from-multiple-tables-Joining-tables" title="Data Retrieval from multiple tables (Joining tables)">Data Retrieval from multiple tables (Joining tables)</a></li>
<li><a href="#Aggregation-and-grouping" title="Aggregation and grouping">Aggregation and grouping</a></li>
</ul>
</li>
<li><a href="#Graph-databases" title="Graph databases">Graph databases</a><ul>
<li><a href="#Download-and-Install-Neo4j" title="Download and Install Neo4j">Download and Install Neo4j</a></li>
</ul>
</li>
<li><a href="#Cypher" title="Cypher">Cypher</a><ul>
<li><a href="#Key-Neo4j-terminology" title="Key Neo4j terminology">Key Neo4j terminology</a></li>
<li><a href="#Core-concepts" title="Core concepts">Core concepts</a></li>
<li><a href="#Patterns" title="Patterns">Patterns</a><ul>
<li><a href="#Node-patterns" title="Node patterns">Node patterns</a></li>
<li><a href="#Relationship-patterns" title="Relationship patterns">Relationship patterns</a></li>
<li><a href="#Path-patterns" title="Path patterns">Path patterns</a></li>
<li><a href="#Path-pattern-matching" title="Path pattern matching">Path pattern matching</a></li>
</ul>
</li>
<li><a href="#Property-types" title="Property types">Property types</a></li>
<li><a href="#Structural-types" title="Structural types">Structural types</a></li>
<li><a href="#Composite-types" title="Composite types">Composite types</a></li>
<li><a href="#How-to-define-a-variable" title="How to define a variable">How to define a variable</a></li>
<li><a href="#Operators" title="Operators">Operators</a><ul>
<li><a href="#DISTINCT-aggregation-operator" title="DISTINCT (aggregation operator)">DISTINCT (aggregation operator)</a></li>
<li><a href="#Property-operators" title="Property operators">Property operators</a></li>
<li><a href="#Mathemtical-operators" title="Mathemtical operators">Mathemtical operators</a></li>
<li><a href="#Comparison-operators" title="Comparison operators">Comparison operators</a></li>
<li><a href="#Boolean-operators" title="Boolean operators">Boolean operators</a></li>
<li><a href="#String-operators" title="String operators">String operators</a></li>
</ul>
</li>
<li><a href="#Patterns1" title="Patterns">Patterns</a><ul>
<li><a href="#Patterns-for-nodes" title="Patterns for nodes">Patterns for nodes</a></li>
<li><a href="#Patterns-for-related-nodes" title="Patterns for related nodes">Patterns for related nodes</a></li>
<li><a href="#Patterns-for-labels" title="Patterns for labels">Patterns for labels</a></li>
<li><a href="#Specifying-properties" title="Specifying properties">Specifying properties</a></li>
<li><a href="#Patterns-for-relationships" title="Patterns for relationships">Patterns for relationships</a></li>
<li><a href="#Variable-length-pattern-matching" title="Variable-length pattern matching">Variable-length pattern matching</a></li>
<li><a href="#Assigning-to-path-variables" title="Assigning to path variables">Assigning to path variables</a></li>
</ul>
</li>
<li><a href="#Cypher-and-APOC" title="Cypher and APOC">Cypher and APOC</a><ul>
<li><a href="#Install-APOC-library" title="Install APOC library">Install APOC library</a></li>
</ul>
</li>
<li><a href="#Build-the-database" title="Build the database">Build the database</a></li>
</ul>
</li>
<li><a href="#Data-Retrieval-with-Cypher" title="Data Retrieval with Cypher">Data Retrieval with Cypher</a></li>
<li><a href="#References" title="References">References</a></li>
</ul>
</div><p></p><h1 id="Prerequisites"><a class="anchor hidden-xs" href="#Prerequisites" title="Prerequisites"><i class="fa fa-link"></i></a>Prerequisites</h1><ul>
<li>HDP Sandbox is installed</li>
<li>Familiarity with SQL and PostgreSQL server</li>
</ul><h1 id="Objectives"><a class="anchor hidden-xs" href="#Objectives" title="Objectives"><i class="fa fa-link"></i></a>Objectives</h1><ul>
<li>Access <code>PostgreSQL</code> database server</li>
<li>Practice on SQL queries on a relational database</li>
<li>Install Neo4j on the local machine or HDP Sandbox (optional)</li>
<li>Perform some CRUD operations on a graph database</li>
</ul><h1 id="Introduction"><a class="anchor hidden-xs" href="#Introduction" title="Introduction"><i class="fa fa-link"></i></a>Introduction</h1><p>The Structured Query Language (SQL) is the most extensively used database language. SQL is composed of a data definition language (DDL), which allows the specification of database schemas; a data manipulation language (DML), which supports operations to retrieve, store, modify and delete data. In this lab, we will practice how to retrieve structured data from relational databases using SQL.  Then we will build a graph for the same dataset on Neo4j and return connected data via Cypher queries.</p><h1 id="Dataset-Descripion"><a class="anchor hidden-xs" href="#Dataset-Descripion" title="Dataset-Descripion"><i class="fa fa-link"></i></a>Dataset Descripion</h1><p>This dataset contains four tables about social media users.</p><ul>
<li><strong>users. csv</strong> contains data about the users of the social net.</li>
<li><strong>friends.csv</strong> contains data about their friendship status</li>
<li><strong>posts.csv</strong> contains data about the posts they made</li>
</ul><table>
<thead>
<tr>
<th>File name</th>
<th>Description</th>
<th>Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td>users.csv</td>
<td>A line is added to this file when a user is subscribed to the socia media along with the age and subscription date time</td>
<td>userid, surname, name, age, timestamp</td>
</tr>
<tr>
<td>posts.csv</td>
<td>The user can add multiple posts and for each post we have post type and post unix timestamp</td>
<td>postid, user, posttype, posttimestamp</td>
</tr>
<tr>
<td>friends.csv</td>
<td>The user can have friends and this relationship is mutual</td>
<td>friend1, friend2</td>
</tr>
</tbody>
</table><h1 id="Build-the-relational-database"><a class="anchor hidden-xs" href="#Build-the-relational-database" title="Build-the-relational-database"><i class="fa fa-link"></i></a>Build the relational database</h1><ol>
<li>Create the database <code>social</code></li>
</ol><pre><code class="wrap sql hljs"><span class="hljs-comment">-- Create Database</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> social;

<span class="hljs-comment">-- Switch to the Database</span>
\c social;

<span class="hljs-comment">-- add User table</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">Users</span>(
userid <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
surname <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
<span class="hljs-keyword">name</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
age <span class="hljs-built_in">INT</span>,
_timestamp <span class="hljs-built_in">timestamp</span>,
temp <span class="hljs-built_in">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);

<span class="hljs-comment">-- add Post table</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> Posts(
postid <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
userid <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
posttype <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
posttimestamp <span class="hljs-built_in">timestamp</span>,
temp <span class="hljs-built_in">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);

<span class="hljs-comment">-- add Friend table</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> Friends(
friend1 <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
friend2 <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);

<span class="hljs-comment">-- add constrains</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Friends
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_User_userid_friend1
<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (friend1)
<span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">Users</span> (userid);

<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Friends
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_User_userid_friend2
<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (friend2)
<span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">Users</span> (userid);

<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Posts
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> fk_User_userid_userid
<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (userid)
<span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">Users</span> (userid);
</code></pre><ol start="2">
<li>Upload the csv data into tables</li>
</ol><pre><code class="wrap sql hljs">
\COPY Users(userid, surname, name, age, temp)  FROM 'users.csv'  DELIMITER ','  CSV HEADER;
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">Users</span> <span class="hljs-keyword">SET</span> _timestamp = TO_TIMESTAMP(temp);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">Users</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span> temp;


\COPY Posts(postid, userid, posttype, temp) FROM 'posts.csv' CSV HEADER;
<span class="hljs-keyword">UPDATE</span> Posts <span class="hljs-keyword">SET</span> posttimestamp = TO_TIMESTAMP(temp);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Posts <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span> temp;


\COPY Friends from 'friends.csv' csv header;
</code></pre><h2 id="Fix-Friends-table"><a class="anchor hidden-xs" href="#Fix-Friends-table" title="Fix-Friends-table"><i class="fa fa-link"></i></a>Fix Friends table</h2><pre><code class="wrap sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> friends2 <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> friend1, friend2 <span class="hljs-keyword">FROM</span> friends
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> friend2, friend1 <span class="hljs-keyword">FROM</span> friends;


<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> friends <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TO</span> friends_old;

<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> friends2 RENAMT <span class="hljs-keyword">TO</span> friends;

</code></pre><h1 id="Data-Retrieval-using-SQL"><a class="anchor hidden-xs" href="#Data-Retrieval-using-SQL" title="Data-Retrieval-using-SQL"><i class="fa fa-link"></i></a>Data Retrieval using SQL</h1><p>In this part of the lab, we will practice on writing SQL queries to retrieve data from our database.</p><h2 id="Data-Retrieval-from-a-single-table"><a class="anchor hidden-xs" href="#Data-Retrieval-from-a-single-table" title="Data-Retrieval-from-a-single-table"><i class="fa fa-link"></i></a>Data Retrieval from a single table</h2><p>You can return data from a single table by using <code>SELECT</code> command. This kind of data retrieval is the simplest way to get data from a single table.</p><div class="alert alert-success">
<h3 id="Exercises0"><a class="anchor hidden-xs" href="#Exercises0" title="Exercises0"><i class="fa fa-link"></i></a>Exercises</h3>
<ol>
<li>Who are the users who have posts?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> userid
<span class="hljs-keyword">FROM</span> posts;
</code></pre>
<ol start="2">
<li>What are the posts of the users?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> postid
<span class="hljs-keyword">FROM</span> posts;
</code></pre>
<ol start="3">
<li>Which posts published after 2012?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">YEAR</span> <span class="hljs-keyword">FROM</span> posttimestamp) &gt; <span class="hljs-number">2012</span>;
</code></pre>
<ol start="4">
<li>What is the oldest and recent dates of the posts?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(posttimestamp), <span class="hljs-keyword">MIN</span>(posttimestamp)
<span class="hljs-keyword">FROM</span> posts;
</code></pre>
<ol start="5">
<li>What are the top 5 most recent posts whose type is <code>Image</code>?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> * 
<span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> posttype=<span class="hljs-string">'Image'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> posttimestamp <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span>;
</code></pre>
<ol start="6">
<li>Which top 5 users who posted an <code>Image</code> or <code>Video</code> recently?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> userid, posttype
<span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> posttype <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Image'</span>, <span class="hljs-string">'Video'</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> posttimestamp <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span>;
</code></pre>
<ol start="7">
<li>What is the age of the eldest and youngest persons?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(age), <span class="hljs-keyword">MIN</span>(age)
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>;

<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">users</span>
<span class="hljs-keyword">SET</span> age = <span class="hljs-keyword">CASE</span>
           <span class="hljs-keyword">WHEN</span> age &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> -age
           <span class="hljs-keyword">ELSE</span> age
          <span class="hljs-keyword">END</span>;

</code></pre>
</div><div class="alert alert-warning">
<p>In PostgreSQL, double quotes <code>""</code> are used to indicate identifiers within the database, which are objects like tables, column names, and roles. In contrast, single quotes <code>''</code> are used to indicate string literals.</p>
</div><h2 id="Data-Retrieval-from-multiple-tables-Joining-tables"><a class="anchor hidden-xs" href="#Data-Retrieval-from-multiple-tables-Joining-tables" title="Data-Retrieval-from-multiple-tables-Joining-tables"><i class="fa fa-link"></i></a>Data Retrieval from multiple tables (Joining tables)</h2><div class="alert alert-success">
<h3 id="Exercises1"><a class="anchor hidden-xs" href="#Exercises1" title="Exercises1"><i class="fa fa-link"></i></a>Exercises</h3>
<ol start="8">
<li>Who is the 2nd youngest person who published <code>Image</code> posts?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">name</span>, surname, age, posttype
<span class="hljs-keyword">FROM</span> posts 
<span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">ON</span> posts.userid = users.userid
<span class="hljs-keyword">WHERE</span> posts.posttype=<span class="hljs-string">'Image'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age <span class="hljs-keyword">ASC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">1</span>;
</code></pre>
<ol start="9">
<li>What are the posts that are published by people who are between 20 and 30?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> postid, posttype, age, users.userid
<span class="hljs-keyword">FROM</span> posts 
<span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">ON</span> posts.userid = users.userid
<span class="hljs-keyword">WHERE</span> age &lt;@ int4range(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age;
</code></pre>
<ol start="10">
<li>What are the friends of the youngest person?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">WITH</span> youngest <span class="hljs-keyword">AS</span>(
    <span class="hljs-keyword">SELECT</span> userid 
    <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> 
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age 
    <span class="hljs-keyword">ASC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>
)
<span class="hljs-keyword">SELECT</span> friend1 <span class="hljs-keyword">AS</span> <span class="hljs-keyword">user</span>, friend2 <span class="hljs-keyword">AS</span> friend
<span class="hljs-keyword">FROM</span> youngest, friends
<span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">ON</span> friends.friend1 = users.userid
<span class="hljs-keyword">WHERE</span> users.userid = youngest.userid;
</code></pre>
<ol start="11">
<li>How many friends for the surname <code>Thronton</code>?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(friend2)
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>
<span class="hljs-keyword">JOIN</span> friends <span class="hljs-keyword">ON</span> (users.userid = friends.friend1)
<span class="hljs-keyword">WHERE</span> users.surname = <span class="hljs-string">'Thronton'</span>;
</code></pre>
</div><h2 id="Aggregation-and-grouping"><a class="anchor hidden-xs" href="#Aggregation-and-grouping" title="Aggregation-and-grouping"><i class="fa fa-link"></i></a>Aggregation and grouping</h2><div class="alert alert-success">
<h3 id="Exercises0"><a class="anchor hidden-xs" href="#Exercises0" title="Exercises0"><i class="fa fa-link"></i></a>Exercises</h3>
<ol start="12">
<li>How many posts for each user?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> users.userid, <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">as</span> c
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>
<span class="hljs-keyword">JOIN</span> posts <span class="hljs-keyword">ON</span> (users.userid = posts.userid)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> users.userid
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c <span class="hljs-keyword">DESC</span>;
</code></pre>
<ol start="13">
<li>Who are the friends of users who posted <code>Image</code>?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> u2.userid, u2.name, u2.surname, u2.age, u.userid, u.name, u.surname
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
<span class="hljs-keyword">JOIN</span> friends f <span class="hljs-keyword">ON</span> f.friend1 = u.userid
<span class="hljs-keyword">JOIN</span> posts <span class="hljs-keyword">ON</span> posts.userid = u.userid
<span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> u2 <span class="hljs-keyword">ON</span> f.friend2 = u2.userid
<span class="hljs-keyword">WHERE</span> posts.posttype = <span class="hljs-string">'Image'</span>;
</code></pre>
<ol start="14">
<li>How many friends of users whose age is less than 20?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> f1.friend2) <span class="hljs-keyword">as</span> c
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
<span class="hljs-keyword">JOIN</span> friends f1 <span class="hljs-keyword">ON</span> (u.userid = f1.friend1)
<span class="hljs-keyword">WHERE</span> u.age &lt; <span class="hljs-number">20</span>;
</code></pre>
<ol start="15">
<li>How many friends of friends of users whose age is less than 20?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> f2.friend2) <span class="hljs-keyword">as</span> c
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
<span class="hljs-keyword">JOIN</span> friends f1 <span class="hljs-keyword">ON</span> (u.userid = f1.friend1)
<span class="hljs-keyword">JOIN</span> friends f2 <span class="hljs-keyword">ON</span> (f1.friend2 = f2.friend1)
<span class="hljs-keyword">WHERE</span> u.age &lt; <span class="hljs-number">20</span> <span class="hljs-keyword">AND</span> f2.friend2 &lt;&gt; u.userid;
</code></pre>
<ol start="16">
<li>How many users have more than 10 posts?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">WITH</span> users_10_posts <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> posts.userid, <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">as</span> c
    <span class="hljs-keyword">FROM</span> posts
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> posts.userid
    <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt; <span class="hljs-number">10</span>
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">as</span> c
<span class="hljs-keyword">FROM</span> users_10_posts;
</code></pre>
<ol start="17">
<li>What is the average number of posts published at noon and by the friends of the users whose age is more than 40?</li>
</ol>
<pre><code class="wrap sql hljs">
<span class="hljs-keyword">WITH</span> post_count <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(posts.postid) <span class="hljs-keyword">AS</span> c
    <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
    <span class="hljs-keyword">JOIN</span> friends f <span class="hljs-keyword">ON</span> f.friend1 = u.userid
    <span class="hljs-keyword">JOIN</span> posts <span class="hljs-keyword">ON</span> posts.userid = f.friend1
    <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> u2 <span class="hljs-keyword">ON</span> f.friend1 = u2.userid
    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">HOUR</span> <span class="hljs-keyword">FROM</span> u2._timestamp) = <span class="hljs-number">12</span> <span class="hljs-keyword">AND</span> u.age &gt; <span class="hljs-number">40</span>
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(c)
<span class="hljs-keyword">FROM</span> post_count;
</code></pre>
<ol start="18">
<li>What is the percentage of posts published at noon and by the friends of the users whose age is more than 40?</li>
</ol>
<pre><code class="wrap sql hljs"><span class="hljs-keyword">WITH</span> post_count <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(posts.postid) <span class="hljs-keyword">AS</span> c
    <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> u
    <span class="hljs-keyword">JOIN</span> friends f <span class="hljs-keyword">ON</span> f.friend1 = u.userid
    <span class="hljs-keyword">JOIN</span> posts <span class="hljs-keyword">ON</span> posts.userid = f.friend1
    <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">users</span> u2 <span class="hljs-keyword">ON</span> f.friend1 = u2.userid
    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXTRACT</span>(<span class="hljs-keyword">HOUR</span> <span class="hljs-keyword">FROM</span> u2._timestamp) = <span class="hljs-number">12</span> <span class="hljs-keyword">AND</span> u.age &gt; <span class="hljs-number">40</span>) ,
    post_total <span class="hljs-keyword">AS</span> (
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">as</span> c2
        <span class="hljs-keyword">FROM</span> posts
    )
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">100</span> * c/c2 || <span class="hljs-string">'%'</span>
<span class="hljs-keyword">FROM</span> post_total, post_count;
</code></pre>
</div><h1 id="Graph-databases"><a class="anchor hidden-xs" href="#Graph-databases" title="Graph-databases"><i class="fa fa-link"></i></a>Graph databases</h1><p>A graph database stores nodes and relationships instead of tables, or documents. Data is stored just like you might sketch ideas on a whiteboard. Your data is stored without restricting it to a pre-defined model, allowing a very flexible way of thinking about and using it.</p><p>Graph databases address big challenges many of us tackle daily. Modern data problems often involve many-to-many relationships with heterogeneous data that sets up needs to:</p><ul>
<li>Navigate deep hierarchies,</li>
<li>Find hidden connections between distant items, and</li>
<li>Discover inter-relationships between items.</li>
</ul><p>Whether its a social network, payment networks, or road network youll find that everything is an interconnected graph of relationships. And when we want to ask questions about the real world, many questions are about the relationships rather than about the individual data elements.</p><center>
<img src="https://i.imgur.com/TolfC5Q.png" width="400">
<p>Example of a simple graph database
</p>
</center><p>Neo4j is an open-source, NoSQL, native graph database that provides an ACID-compliant transactional backend for your applications that has been publicly available since 2007. In Neo4j, information is organized as nodes, relationships, and properties. We can retrieve data from Neo4j via its query language called Cypher which is a declarative query language similar to SQL, but optimized for graphs.</p><center>
<img src="https://i.imgur.com/JE0Cr95.png" width="400">
<p>Building blocks of the property graph model
</p>
</center><p>The property graph model consists of mainly nodes and relationships. Nodes are the entities in the graph.</p><ul>
<li>Nodes can be tagged with labels, representing their different roles in your domain. (For example, Person).</li>
<li>Nodes can hold any number of key-value pairs, or properties. (For example, name).</li>
<li>Node labels may also attach metadata (such as index or constraint information) to certain nodes.</li>
</ul><p>Whereas relationships provide directed, named, connections between two node entities (e.g. Person LOVES Person).</p><ul>
<li>Relationships always have a direction, a type, a start node, and an end node, and they can have properties, just like nodes.</li>
<li>Nodes can have any number or type of relationships without sacrificing performance.</li>
<li>Although relationships are always directed, they can be navigated efficiently in any direction.</li>
</ul><h2 id="Download-and-Install-Neo4j"><a class="anchor hidden-xs" href="#Download-and-Install-Neo4j" title="Download-and-Install-Neo4j"><i class="fa fa-link"></i></a>Download and Install Neo4j</h2><p>Neo4j can be installed as an interpreter in Zeppelin but in HDP 2.6.5, Zeppelin 0.7.3 is installed and does not support neo4j interpreter. Installing Neo4j on HDP 2.6.5 as a Zeppelin interpreter will not work. The latest version (in Feb. 2023) of Zeppelin 0.10.0 supports Neo4j but we do not need to install it. Indeed, HDP 3.0 has Zeppelin 0.8.0 installed and supports neo4j interpreter but it is not a big deal to install HDP 3.0 just for neo4j since our work on the sandbox will not be mostly on graph databases.</p><div class="alert alert-danger">
<p>If you are downloading Neo4j Desktop from Russia, select <code>other</code> from country list and use some proxy server.</p>
</div><p>The <strong>easy</strong> approach is to install Neo4j Desktop on your local machine. You can find here (<a href="https://neo4j.com/docs/desktop-manual/current/installation/download-installation/" target="_blank" rel="noopener">https://neo4j.com/docs/desktop-manual/current/installation/download-installation/</a>) some information about installing Neo4j Desktop and you can find here (<a href="https://neo4j.com/download-center/" target="_blank" rel="noopener">https://neo4j.com/download-center/</a>) download links. After you start downloading, the website will give a long key you need to use when you install the software as follows:<br>
<img src="https://i.imgur.com/bwbGHJ5.png" alt="" class="md-image md-image"></p><p>The software will prepare the environment for installation as follows.</p><center>
<img src="https://i.imgur.com/XvkI0rv.png" width="300">
<p>Installing Neo4j Desktop
</p>
</center><p>When you succeed installation, it will show the following dashboard.<br>
<img src="https://i.imgur.com/P3QBb6U.png" alt="" class="md-image md-image"></p><p>The <strong>less easy</strong> approach is to install Neo4j on your cluster node via <code>yum</code> OR offline via <code>rpm</code>. You can find here (<a href="https://yum.neo4j.com" target="_blank" rel="noopener">https://yum.neo4j.com</a>) some information about installing neo4j via <code>yum</code> and here (<a href="https://neo4j.com/docs/operations-manual/3.5/installation/linux/rpm/#linux-yum" target="_blank" rel="noopener">https://neo4j.com/docs/operations-manual/3.5/installation/linux/rpm/#linux-yum</a>) some information about offline installation. After that, you can forward the port of the server to some custom port 10015 to the host machine in order to access Neo4j Browser (change this setting <code>server.http.listen_address</code> to 10015 in <code>neo4j.conf</code> file of the Neo4j DBMS instance).</p><div class="alert alert-warning">
<p>If you want to install Neo4j on the cluster, you need to know that the old versions of Neo4j can be installed. I suggest the version 3.5.35.1 and you can see below the cypher shell dependencies.<br>
<img src="https://i.imgur.com/I6bj6a9.png" alt="" class="md-image md-image"><br>
<img src="https://i.imgur.com/xrZ2Eib.png" alt="" class="md-image md-image"></p>
</div><div class="alert alert-info">
<p>You can access the guest machine in VirtualBox by ssh into the <code>HostSSH</code> port specified in the <code>port forwarding rules</code> which can be reached from the network settings of the virtual machine. You can also add your rules to the list.</p>
</div><p>You can access the Neo4j Browser usually at <a href="http://localhost:7474" target="_blank" rel="noopener">http://localhost:7474</a>.</p><div class="alert alert-danger">
<p>If you can not install Neo4j due to some reason, you can open a free session of Neo4j Sandbox at <a href="https://neo4j.com/sandbox/" target="_blank" rel="noopener">https://neo4j.com/sandbox/</a> but you need proxy.</p>
</div><h1 id="Cypher"><a class="anchor hidden-xs" href="#Cypher" title="Cypher"><i class="fa fa-link"></i></a>Cypher</h1><p>Cypher is Neo4js graph database query language that allows users to store and retrieve data from the graph database. It is a declarative, SQL-inspired language for describing visual patterns in graphs. The syntax provides a visual and logical way to match patterns of nodes and relationships in the graph. Cypher keywords are not case-sensitive but it is case-sensitive for variables.</p><p>Cypher and SQL are similar in many ways. For example, they share many of the same keywords, such as WHERE and ORDER BY. However, there are some important differences between the two:</p><ul>
<li>Cypher is schema-flexible
<ul>
<li>Cypher and Neo4j offers a greater degree of schema-flexibility than SQL and a relational database. More specifically, nodes and relationships in a Neo4j database do not have to have a specific property set to them because other nodes or relationships in the same graph have that property</li>
</ul>
</li>
<li>Query order
<ul>
<li>SQL queries begin with what a user wants to return, whereas Cypher queries end with the return clause.</li>
<li>Example:<pre><code class="wrap sql hljs"><span class="hljs-comment">-- SQL query</span>
<span class="hljs-keyword">SELECT</span> user.name
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>
<span class="hljs-keyword">WHERE</span> user.age &gt; <span class="hljs-number">26</span>
</code></pre>
<pre><code class="wrap pony hljs"><span class="hljs-comment">// Cypher query</span>
<span class="hljs-type">MATCH</span> (user:<span class="hljs-type">User</span>)
<span class="hljs-type">WHERE</span> user.age &gt; <span class="hljs-number">26</span>
<span class="hljs-type">RETURN</span> user.name
</code></pre>
</li>
</ul>
</li>
<li>Cypher queries are more concise
<ul>
<li>For example, consider the following two queries (both searching a database for the names of the actors in the movie The Matrix), the first written with SQL and the second with Cypher:</li>
<li>Example:<pre><code class="wrap sql hljs"><span class="hljs-comment">-- SQL query</span>
<span class="hljs-keyword">SELECT</span> actors.name
<span class="hljs-keyword">FROM</span> actors
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> acted_in <span class="hljs-keyword">ON</span> acted_in.actor_id = actors.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> movies <span class="hljs-keyword">ON</span> movies.id = acted_in.movie_id
<span class="hljs-keyword">WHERE</span> movies.title = <span class="hljs-string">"The Matrix"</span>
</code></pre>
<pre><code class="wrap pony hljs"><span class="hljs-comment">// Cypher query</span>
<span class="hljs-type">MATCH</span> (<span class="hljs-keyword">actor</span>:<span class="hljs-type">Actor</span>)-[:<span class="hljs-type">ACTED_IN</span>]-&gt;(movie:<span class="hljs-type">Movie</span> {title: <span class="hljs-string">'The Matrix'</span>})
<span class="hljs-type">RETURN</span> <span class="hljs-keyword">actor</span>.name
</code></pre>
</li>
</ul>
</li>
</ul><h2 id="Key-Neo4j-terminology"><a class="anchor hidden-xs" href="#Key-Neo4j-terminology" title="Key-Neo4j-terminology"><i class="fa fa-link"></i></a>Key Neo4j terminology</h2><p>Cypher queries are executed against a Neo4j database, but normally apply to specific graphs. It is important to understand the meaning of these terms and exactly when a graph is not a database.</p><ul>
<li>DBMS
<ul>
<li>A Neo4j Database Management System is capable of containing and managing multiple graphs contained in databases. Client applications will connect to the DBMS and open sessions against it. A client session provides access to any graph in the DBMS.</li>
</ul>
</li>
<li>Graph
<ul>
<li>Refers to a data model within a database. Normally there is only one graph within each database, and many administrative commands that refer to a specific graph do so using the database name.</li>
<li>Composite databases can contain multiple graphs, by means of aliases to other databases.</li>
</ul>
</li>
<li>Database
<ul>
<li>A database is a storage and retrieval mechanism for collecting data in a defined space on disk and in memory.</li>
</ul>
</li>
</ul><h2 id="Core-concepts"><a class="anchor hidden-xs" href="#Core-concepts" title="Core-concepts"><i class="fa fa-link"></i></a>Core concepts</h2><p>Fundamentally, a Neo4j graph database consists of three core entities: nodes, relationships, and paths.</p><ul>
<li>
<p>Nodes</p>
<ul>
<li>The data entities in a Neo4j graph database are called nodes. Nodes are referred to in Cypher using parenthesis ().</li>
</ul>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (n:<span class="hljs-type">Person</span> {name:<span class="hljs-string">'Anna'</span>})
<span class="hljs-type">RETURN</span> n.born <span class="hljs-type">AS</span> birthYear
</code></pre>
<ul>
<li>In this example, the first <code>MATCH</code> clause finds all Person nodes in the graph with the name property set to Anna, and binds them to the variable <code>n</code>. The variable <code>n</code> is then passed along to the subsequent <code>RETURN</code> clause, which returns the value of a different property <code>(born)</code> belonging to the same node.</li>
<li>In the above example, the node includes the following:
<ul>
<li>A <code>Person</code> label. Labels are like tags, and are used to query the database for specific nodes. A node may have multiple labels, for example <code>Person</code> and <code>Actor</code>.</li>
<li>A <code>name</code> property set to <code>Anna</code>. Properties are defined within curly braces, <code>{}</code>, and are used to provide nodes with specific information, which can also be queried for and further improve the ability to pinpoint data.</li>
<li>A variable, <code>n</code>. Variables allow referencing specified nodes in subsequent clauses.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Relationships</p>
<ul>
<li>Nodes in a graph can be connected with relationships. A relationship must have a start node, an end node, and exactly one type. Relationships are represented in Cypher with arrows (e.g. --&gt;) indicating the direction of a relationship.</li>
</ul>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (:<span class="hljs-type">Person</span> {name: <span class="hljs-string">'Anna'</span>})-[r:<span class="hljs-type">KNOWS</span> <span class="hljs-type">WHERE</span> r.since &lt; <span class="hljs-number">2020</span>]-&gt;(friend:<span class="hljs-type">Person</span>)
<span class="hljs-type">RETURN</span> count(r) <span class="hljs-type">As</span> numberOfFriends
</code></pre>
<ul>
<li>The query example above matches for relationships of type <code>KNOWS</code> and with the property since set to less than 2020. The query also requires the relationships to go from a <code>Person</code> node named <code>Anna</code> to any other Person nodes, referred to as friend. The <code>count()</code> function is used in the <code>RETURN</code> clause to count all the relationships bound by the r variable in the preceding <code>MATCH</code> clause (i.e. how many friends Anna has known since before 2020).</li>
<li>Note that while nodes can have several labels, relationships can only have one type.</li>
</ul>
</li>
<li>
<p>Paths</p>
<ul>
<li>Paths in a graph consist of connected nodes and relationships. Exploring these paths sits at the very core of Cypher.</li>
</ul>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (n:<span class="hljs-type">Person</span> {name: <span class="hljs-string">'Anna'</span>})-[:<span class="hljs-type">KNOWS</span>]-{<span class="hljs-number">1</span>,<span class="hljs-number">5</span>}(friend:<span class="hljs-type">Person</span> <span class="hljs-type">WHERE</span> n.born &lt; friend.born)
<span class="hljs-type">RETURN</span> <span class="hljs-type">DISTINCT</span> friend.name <span class="hljs-type">AS</span> olderConnections
</code></pre>
<ul>
<li>This example uses a <code>quantified relationship</code> to find all paths up to <code>5</code> hops away, traversing only relationships of type <code>KNOWS</code> from the start node <code>Anna</code> to other older <code>Person</code> nodes (as defined by the <code>WHERE</code> clause). The <code>DISTINCT</code> operator is used to ensure that the <code>RETURN</code> clause only returns <code>unique</code> nodes.</li>
<li>Paths can also be assigned variables. For example, the below query binds a whole path pattern, which matches the <code>shortest path</code> from <code>Anna</code> to another Person node in the graph up to <code>10</code> hops away with the nationality property set to <code>Canadian</code>. In this case, the <code>RETURN</code> clause returns the full path between the two nodes.</li>
</ul>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> p=shortestPath((:<span class="hljs-type">Person</span> {name: <span class="hljs-string">'Anna'</span>})-[:<span class="hljs-type">KNOWS</span>*<span class="hljs-number">1.</span><span class="hljs-number">.10</span>]-(:<span class="hljs-type">Person</span> {nationality: <span class="hljs-string">'Canadian'</span>}))
<span class="hljs-type">RETURN</span> p
</code></pre>
</li>
</ul><h2 id="Patterns"><a class="anchor hidden-xs" href="#Patterns" title="Patterns"><i class="fa fa-link"></i></a>Patterns</h2><p>Graph pattern matching sits at the very core of <code>Cypher</code>. It is the mechanism used to navigate, describe and extract data from a graph by applying a declarative pattern. Inside a <code>MATCH</code> clause, you can use graph patterns to define the data you are searching for and the data to return.</p><p>A graph pattern describes data using a syntax that is similar to how the nodes and relationships of a property graph are drawn on a whiteboard. On a whiteboard, nodes are drawn as circles and relationships are drawn as arrows. Cypher represents the circles as a pair of parentheses, and the arrows as dashes and greater-than or less-than symbols:</p><pre><code class="wrap pony hljs">()--&gt;()&lt;--()
</code></pre><h3 id="Node-patterns"><a class="anchor hidden-xs" href="#Node-patterns" title="Node-patterns"><i class="fa fa-link"></i></a>Node patterns</h3><ul>
<li>Every graph pattern contains at least one node pattern. The simplest graph pattern is a single, empty node pattern:</li>
</ul><pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> ()
</code></pre><ul>
<li>The empty node pattern matches every node in a property graph. In order to obtain a reference to the nodes matched, a variable needs to be declared in the node pattern:</li>
</ul><pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (n)
<span class="hljs-type">RETURN</span> n.name
</code></pre><ul>
<li>Adding a label expression to the node pattern means only nodes with labels that match will be returned. The following matches nodes that have the <code>Person</code> label:</li>
</ul><pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (n:<span class="hljs-type">Person</span>) <span class="hljs-type">RETURN</span> n
</code></pre><ul>
<li>The following more complex label expression matches all nodes that are either a <code>Student</code> and a <code>Person</code> or <code>Teacher</code>:</li>
</ul><pre><code class="wrap pony hljs"><span class="hljs-type">CREATE</span> (n:<span class="hljs-type">Person</span>:<span class="hljs-type">Student</span>{name:<span class="hljs-string">"Mike"</span>})-[:<span class="hljs-type">IS_STUDENT</span>]-&gt;(:<span class="hljs-type">Person</span>:<span class="hljs-type">Teacher</span>{name:<span class="hljs-string">"Tim"</span>})
</code></pre><pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (n:(<span class="hljs-type">Student</span>&amp;<span class="hljs-type">Person</span>)|<span class="hljs-type">Teacher</span>) <span class="hljs-type">RETURN</span> n
</code></pre><ul>
<li>A map of property names and values can be used to match on node properties based on equality with the specified values. The following matches nodes that have their name property equal to <code>Tim</code>:</li>
</ul><pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (n { name: <span class="hljs-string">'Tim'</span> }) <span class="hljs-type">RETURN</span> n
</code></pre><ul>
<li>More general predicates can be expressed with a <code>WHERE</code> clause. The following matches nodes whose name property starts with <code>T</code>:</li>
</ul><pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (n:<span class="hljs-type">Person</span> <span class="hljs-type">WHERE</span> n.name <span class="hljs-type">STARTS</span> <span class="hljs-type">WITH</span> <span class="hljs-string">'T'</span>) <span class="hljs-type">RETURN</span> n

<span class="hljs-type">MATCH</span> (n:<span class="hljs-type">Person</span> <span class="hljs-type">WHERE</span> n.name =~ <span class="hljs-string">'T.*'</span>) <span class="hljs-type">RETURN</span> n
</code></pre><h3 id="Relationship-patterns"><a class="anchor hidden-xs" href="#Relationship-patterns" title="Relationship-patterns"><i class="fa fa-link"></i></a>Relationship patterns</h3><ul>
<li>The simplest possible relationship pattern is a pair of dashes:</li>
</ul><pre><code class="wrap pony hljs">--
</code></pre><ul>
<li>This pattern matches a relationship with any direction and does not filter on any relationship type or property. Unlike a node pattern, a relationship pattern cannot be used in a <code>MATCH</code> clause without node patterns at both ends.</li>
<li>In order to obtain a reference to the relationships matched by the pattern, a relationship variable needs to be declared in the pattern by adding the variable name in square brackets in between the dashes:</li>
</ul><pre><code class="wrap pony hljs">-[r]-
</code></pre><ul>
<li>To match a specific direction, add <code>&lt;</code> or <code>&gt;</code> to the left or right hand side respectively:</li>
</ul><pre><code class="wrap pony hljs">-[r]-&gt;
</code></pre><ul>
<li>To match on a relationship type, add the type name after a colon:</li>
</ul><pre><code class="wrap pony hljs">-[:<span class="hljs-type">CALLS_AT</span>]-&gt;
</code></pre><ul>
<li>Similar to node patterns, a map of property names and values can be added to filter on properties of the relationship based on equality with the specified values:</li>
</ul><pre><code class="wrap pony hljs">-[{ distance: <span class="hljs-number">0.24</span>, duration: <span class="hljs-string">'PT4M'</span> }]-&gt;
</code></pre><ul>
<li>A <code>WHERE</code> clause can be used for more general predicates:</li>
</ul><pre><code class="wrap pony hljs">-[r <span class="hljs-type">WHERE</span> time() + duration(r.duration) &lt; time(<span class="hljs-string">'22:00'</span>) ]-&gt;
</code></pre><h3 id="Path-patterns"><a class="anchor hidden-xs" href="#Path-patterns" title="Path-patterns"><i class="fa fa-link"></i></a>Path patterns</h3><p>Any valid path starts and ends with a node, with relationships between each node (if there is more than one node). Path patterns have the same restrictions, and for all valid path patterns the following are true:</p><ul>
<li>
<p>They have at least one node pattern.</p>
</li>
<li>
<p>They begin and end with a node pattern.</p>
</li>
<li>
<p>They alternate between nodes and relationships.</p>
</li>
<li>
<p>These are all valid path patterns:</p>
<pre><code class="wrap pony hljs">()
</code></pre>
<pre><code class="wrap pony hljs">(s)--(e)
</code></pre>
<pre><code class="wrap pony hljs">(:<span class="hljs-type">Station</span>)--()&lt;--(m <span class="hljs-type">WHERE</span> m.departs &gt; time(<span class="hljs-string">'12:00'</span>))--&gt;()-[:<span class="hljs-type">NEXT</span>]-&gt;(n)
</code></pre>
</li>
<li>
<p>These are invalid path patterns:</p>
<pre><code class="wrap pony hljs">--&gt;
</code></pre>
<pre><code class="wrap pony hljs">()--&gt;
</code></pre>
<pre><code class="wrap pony hljs">()--&gt;--&gt;()
</code></pre>
</li>
</ul><h3 id="Path-pattern-matching"><a class="anchor hidden-xs" href="#Path-pattern-matching" title="Path-pattern-matching"><i class="fa fa-link"></i></a>Path pattern matching</h3><p>This section contains an example of matching a path pattern to paths in a property graph.</p><p>It uses the following graph:</p><p><img src="https://neo4j.com/docs/cypher-manual/5/_images/path_pattern_example_graph.svg" alt="" class="md-image md-image"></p><p>To recreate the graph, run the following query against an empty Neo4j database:</p><pre><code class="wrap pony hljs"><span class="hljs-type">CREATE</span> (pmr:<span class="hljs-type">Station</span> {name: <span class="hljs-string">'Peckham Rye'</span>}),
    (dmk:<span class="hljs-type">Station</span> {name: <span class="hljs-string">'Denmark Hill'</span>}),
    (vic:<span class="hljs-type">Station</span> {name: <span class="hljs-string">'London Victoria'</span>}),
    (clp:<span class="hljs-type">Station</span> {name: <span class="hljs-string">'Clapham High Street'</span>}),
    (eph:<span class="hljs-type">Station</span> {name: <span class="hljs-string">'Elephant &amp; Castle'</span>}),
    (vic)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s1:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:55'</span>)}),
    (dmk)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s2:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:44'</span>)})-[:<span class="hljs-type">NEXT</span>]-&gt;(s1),
    (pmr)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s3:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:40'</span>)})-[:<span class="hljs-type">NEXT</span>]-&gt;(s2),
    (clp)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s4:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:41'</span>)}),
    (dmk)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s5:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:37'</span>)})-[:<span class="hljs-type">NEXT</span>]-&gt;(s4),
    (pmr)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s6:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:33'</span>)})-[:<span class="hljs-type">NEXT</span>]-&gt;(s5),
    (eph)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s7:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:54'</span>)}),
    (dmk)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s8:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:47'</span>)})-[:<span class="hljs-type">NEXT</span>]-&gt;(s7),
    (pmr)&lt;-[:<span class="hljs-type">CALLS_AT</span>]-(s9:<span class="hljs-type">Stop</span> {departs: time(<span class="hljs-string">'11:44'</span>)})-[:<span class="hljs-type">NEXT</span>]-&gt;(s8)
</code></pre><p>The graph contains a number of train <code>Stations</code> and <code>Stops</code>. A <code>Stop</code> represents the arrival and departure of a train that <code>CALLS_AT</code> a Station. Each <code>Stop</code> forms part of a sequence of <code>Stops</code> connected by relationships with the type <code>NEXT</code>, representing the order of calling points made by a train service.</p><p>The graph shows three chains of <code>Stops</code> that represent different train services. Each of these services calls at the <code>Station</code> with the name <code>Denmark Hill</code>.</p><p>To return all <code>Stops</code> that call at the Station <code>Denmark Hill</code>, the following <strong>motif</strong> is used (the term motif is used to describe the pattern looked for in the graph):<br>
<img src="https://neo4j.com/docs/cypher-manual/5/_images/path_pattern_motif.svg" alt="" class="md-image md-image"></p><p>In this case, three paths in the graph match the structure of the motif (plus the predicate anchoring to the <code>Station Denmark Hill</code>):<br>
<img src="https://neo4j.com/docs/cypher-manual/5/_images/path_pattern_solutions.svg" alt="" class="md-image md-image"></p><p>In order to return the name of each <code>Stop</code> that calls at a Station, declare a variable in the <code>Stop</code> node pattern. The results will then have a row containing the departs value of each <code>Stop</code> for each match shown above:</p><pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (s:<span class="hljs-type">Stop</span>)-[:<span class="hljs-type">CALLS_AT</span>]-&gt;(:<span class="hljs-type">Station</span> {name: <span class="hljs-string">'Denmark Hill'</span>})
<span class="hljs-type">RETURN</span> s.departs <span class="hljs-type">AS</span> departureTime
</code></pre><p>Cypher provides first class support for a number of data types. These fall into the following three categories: property, structural, and composite.</p><h2 id="Property-types"><a class="anchor hidden-xs" href="#Property-types" title="Property-types"><i class="fa fa-link"></i></a>Property types</h2><p>The following data types are included in the property types category: Integer, Float, String, Boolean, Point, Date, Time, LocalTime, DateTime, LocalDateTime, and Duration. For more details, visit the <a href="https://neo4j.com/docs/cypher-manual/4.4/syntax/values/#_property_type_details" target="_blank" rel="noopener">documentation</a>.</p><h2 id="Structural-types"><a class="anchor hidden-xs" href="#Structural-types" title="Structural-types"><i class="fa fa-link"></i></a>Structural types</h2><p>The following data types are included in the structural types category: Node, Relationship, and Path.</p><ul>
<li>The <strong>Node</strong> data type includes: Id, Label(s), and Map (of properties). Note that labels are not values, but a form of pattern syntax.</li>
<li>The <strong>Relationship</strong> data type includes: Id, Type, Map (of properties), Id of start node, and Id of end node.</li>
<li>The <strong>Path</strong> data type is an alternating sequence of nodes and relationships.</li>
</ul><p>Nodes, relationships, and paths are returned as a result of pattern matching. In Neo4j, all relationships have a direction. However, you can have the notion of undirected relationships at query time.</p><h2 id="Composite-types"><a class="anchor hidden-xs" href="#Composite-types" title="Composite-types"><i class="fa fa-link"></i></a>Composite types</h2><p>The following data types are included in the composite types category: List and Map.</p><pre><code class="wrap pony hljs"><span class="hljs-type">RETURN</span> [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>], {id:<span class="hljs-number">1</span>, msg: <span class="hljs-string">'hello'</span>, age: <span class="hljs-number">31</span>}
</code></pre><h2 id="How-to-define-a-variable"><a class="anchor hidden-xs" href="#How-to-define-a-variable" title="How-to-define-a-variable"><i class="fa fa-link"></i></a>How to define a variable</h2><p>When you reference parts of a pattern or a query, you do so by naming them. The names you give the different parts are called variables.<br>
In this example:</p><pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (n)--&gt;(b)
<span class="hljs-type">RETURN</span> b
</code></pre><p>The variables are n and b.</p><pre><code class="wrap pony hljs"><span class="hljs-comment">// this is a comment</span>
</code></pre><p>A comment begin with double slash (//) and continue to the end of the line. Comments do not execute, they are for humans to read.</p><h2 id="Operators"><a class="anchor hidden-xs" href="#Operators" title="Operators"><i class="fa fa-link"></i></a>Operators</h2><h3 id="DISTINCT-aggregation-operator"><a class="anchor hidden-xs" href="#DISTINCT-aggregation-operator" title="DISTINCT-aggregation-operator"><i class="fa fa-link"></i></a><strong>DISTINCT</strong> (aggregation operator)</h3><pre><code class="wrap pony hljs"><span class="hljs-type">WITH</span> [<span class="hljs-string">'a'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-number">4</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">4</span>] <span class="hljs-type">AS</span> ps
<span class="hljs-type">UNWIND</span> ps <span class="hljs-type">AS</span> p
<span class="hljs-type">RETURN</span> <span class="hljs-type">DISTINCT</span> p
</code></pre><p>The output will have only a, 4, and b.</p><h3 id="Property-operators"><a class="anchor hidden-xs" href="#Property-operators" title="Property-operators"><i class="fa fa-link"></i></a>Property operators</h3><h4 id="The-operator--statically-access-the-property-of-a-node-or-relationship"><a class="anchor hidden-xs" href="#The-operator--statically-access-the-property-of-a-node-or-relationship" title="The-operator--statically-access-the-property-of-a-node-or-relationship"><i class="fa fa-link"></i></a>The operator <code>.</code> statically access the property of a node or relationship</h4><h4 id="The-operator--used-for-filtering-on-a-dynamically-computed-property-key"><a class="anchor hidden-xs" href="#The-operator--used-for-filtering-on-a-dynamically-computed-property-key" title="The-operator--used-for-filtering-on-a-dynamically-computed-property-key"><i class="fa fa-link"></i></a>The operator <code>[]</code> used for filtering on a dynamically-computed property key</h4><pre><code class="wrap pony hljs"><span class="hljs-type">CREATE</span>
  (a:<span class="hljs-type">Restaurant</span> {name: <span class="hljs-string">'Hungry Jo'</span>, rating_hygiene: <span class="hljs-number">10</span>, rating_food: <span class="hljs-number">7</span>}),
  (b:<span class="hljs-type">Restaurant</span> {name: <span class="hljs-string">'Buttercup Tea Rooms'</span>, rating_hygiene: <span class="hljs-number">5</span>, rating_food: <span class="hljs-number">6</span>}),
  (c1:<span class="hljs-type">Category</span> {name: <span class="hljs-string">'hygiene'</span>}),
  (c2:<span class="hljs-type">Category</span> {name: <span class="hljs-string">'food'</span>})
<span class="hljs-type">WITH</span> a, b, c1, c2
<span class="hljs-type">MATCH</span> (restaurant:<span class="hljs-type">Restaurant</span>), (category:<span class="hljs-type">Category</span>)
<span class="hljs-type">WHERE</span> restaurant[<span class="hljs-string">"rating_"</span> + category.name] &gt; <span class="hljs-number">6</span>
<span class="hljs-type">RETURN</span> <span class="hljs-type">DISTINCT</span> restaurant.name
</code></pre><h4 id="The-operator--used-for-replacing-all-properties-of-a-node-or-relationship"><a class="anchor hidden-xs" href="#The-operator--used-for-replacing-all-properties-of-a-node-or-relationship" title="The-operator--used-for-replacing-all-properties-of-a-node-or-relationship"><i class="fa fa-link"></i></a>The operator <code>=</code> used for replacing all properties of a node or relationship</h4><pre><code class="wrap pony hljs"><span class="hljs-type">CREATE</span> (a:<span class="hljs-type">Person</span> {name: <span class="hljs-string">'Jane'</span>, age: <span class="hljs-number">20</span>})
<span class="hljs-type">WITH</span> a
<span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Person</span> {name: <span class="hljs-string">'Jane'</span>})
<span class="hljs-type">SET</span> p = {name: <span class="hljs-string">'Ellen'</span>, livesIn: <span class="hljs-string">'London'</span>}
<span class="hljs-type">RETURN</span> p.name, p.age, p.livesIn
</code></pre><h3 id="Mathemtical-operators"><a class="anchor hidden-xs" href="#Mathemtical-operators" title="Mathemtical-operators"><i class="fa fa-link"></i></a>Mathemtical operators</h3><p>The mathematical operators comprise:</p><ul>
<li>addition: +</li>
<li>subtraction or unary minus: -</li>
<li>multiplication: *</li>
<li>division: /</li>
<li>modulo division: %</li>
<li>exponentiation: ^</li>
</ul><h3 id="Comparison-operators"><a class="anchor hidden-xs" href="#Comparison-operators" title="Comparison-operators"><i class="fa fa-link"></i></a>Comparison operators</h3><p>The comparison operators comprise:</p><ul>
<li>equality: =</li>
<li>inequality: &lt;&gt;</li>
<li>less than: &lt;</li>
<li>greater than: &gt;</li>
<li>less than or equal to: &lt;=</li>
<li>greater than or equal to: &gt;=</li>
<li>IS NULL</li>
<li>IS NOT NULL</li>
</ul><p>String-specific comparison operators comprise:</p><ul>
<li>STARTS WITH: perform case-sensitive prefix searching on strings</li>
<li>ENDS WITH: perform case-sensitive suffix searching on strings</li>
<li>CONTAINS: perform case-sensitive inclusion searching in strings</li>
<li>=~: regular expression for matching a pattern</li>
</ul><pre><code class="wrap pony hljs"><span class="hljs-type">WITH</span> [<span class="hljs-string">'mouse'</span>, <span class="hljs-string">'chair'</span>, <span class="hljs-string">'door'</span>, <span class="hljs-string">'house'</span>] <span class="hljs-type">AS</span> wordlist
<span class="hljs-type">UNWIND</span> wordlist <span class="hljs-type">AS</span> word
<span class="hljs-type">WITH</span> word
<span class="hljs-type">WHERE</span> word =~ <span class="hljs-string">'.*ous.*'</span>
<span class="hljs-type">RETURN</span> word
</code></pre><h3 id="Boolean-operators"><a class="anchor hidden-xs" href="#Boolean-operators" title="Boolean-operators"><i class="fa fa-link"></i></a>Boolean operators</h3><p>The boolean operatorsalso known as logical operatorscomprise: <code>AND</code>, <code>OR</code>, <code>XOR</code>, <code>NOT</code>.</p><h3 id="String-operators"><a class="anchor hidden-xs" href="#String-operators" title="String-operators"><i class="fa fa-link"></i></a>String operators</h3><p>The string operators comprise: concatenating strings: <code>+</code></p><pre><code class="wrap pony hljs"><span class="hljs-type">RETURN</span> <span class="hljs-string">'neo'</span> + <span class="hljs-string">'4j'</span> <span class="hljs-type">AS</span> result
</code></pre><p>Check other operators from the documentation.</p><h2 id="Patterns1"><a class="anchor hidden-xs" href="#Patterns1" title="Patterns1"><i class="fa fa-link"></i></a>Patterns</h2><p>Patterns and pattern-matching are at the very heart of Cypher, so being effective with Cypher requires a good understanding of patterns.<br>
Using patterns, you describe the shape of the data you are looking for. For example, in the MATCH clause you describe the shape with a pattern, and Cypher will figure out how to get that data for you.</p><p>The pattern describes the data using a form that is very similar to how one typically draws the shape of property graph data on a whiteboard: usually as circles (representing nodes) and arrows between them to represent relationships.</p><p>Patterns appear in multiple places in Cypher: in <code>MATCH</code>, <code>CREATE</code> and <code>MERGE</code> clauses, and in pattern expressions.</p><h3 id="Patterns-for-nodes"><a class="anchor hidden-xs" href="#Patterns-for-nodes" title="Patterns-for-nodes"><i class="fa fa-link"></i></a>Patterns for nodes</h3><p>This simple pattern describes a single node, and names that node using the variable a.</p><pre><code class="wrap pony hljs">(a)
</code></pre><h3 id="Patterns-for-related-nodes"><a class="anchor hidden-xs" href="#Patterns-for-related-nodes" title="Patterns-for-related-nodes"><i class="fa fa-link"></i></a>Patterns for related nodes</h3><p>This pattern describes a very simple data shape: two nodes, and a single relationship from one to the other.</p><pre><code class="wrap pony hljs">(a)--&gt;(b)
</code></pre><p>This manner of describing nodes and relationships can be extended to cover an arbitrary number of nodes and the relationships between them, for example:</p><pre><code class="wrap pony hljs">(a)--&gt;(b)&lt;--(c)
</code></pre><p>Such a series of connected nodes and relationships is called a <strong>path</strong>.</p><h3 id="Patterns-for-labels"><a class="anchor hidden-xs" href="#Patterns-for-labels" title="Patterns-for-labels"><i class="fa fa-link"></i></a>Patterns for labels</h3><p>The most simple attribute that can be described in the pattern is a label that the node must have. For example:</p><pre><code class="wrap pony hljs">(a:<span class="hljs-type">User</span>)--&gt;(b)
</code></pre><p>One can also describe a node that has multiple labels:</p><pre><code class="wrap pony hljs">(a:<span class="hljs-type">User</span>:<span class="hljs-type">Admin</span>)--&gt;(b)
</code></pre><h3 id="Specifying-properties"><a class="anchor hidden-xs" href="#Specifying-properties" title="Specifying-properties"><i class="fa fa-link"></i></a>Specifying properties</h3><p>Properties can be expressed in patterns using a map-construct: curly brackets surrounding a number of key-expression pairs, separated by commas. E.g. a node with two properties on it would look like:</p><pre><code class="wrap pony hljs">(a {name: <span class="hljs-string">'Andy'</span>, sport: <span class="hljs-string">'Brazilian Ju-Jitsu'</span>})
</code></pre><p>A relationship with expectations on it is given by:</p><pre><code class="wrap pony hljs">(a)-[{blocked: <span class="hljs-literal">false</span>}]-&gt;(b)
</code></pre><h3 id="Patterns-for-relationships"><a class="anchor hidden-xs" href="#Patterns-for-relationships" title="Patterns-for-relationships"><i class="fa fa-link"></i></a>Patterns for relationships</h3><p>The simplest way to describe a relationship is by using the arrow between two nodes, as in the previous examples. Using this technique, you can describe that the relationship should exist and the directionality of it. If you dont care about the direction of the relationship, the arrow head can be omitted, as exemplified by:</p><pre><code class="wrap pony hljs">(a)--(b)

(a)-[r]-&gt;(b)

(a)-[r:<span class="hljs-type">REL_TYPE</span>]-&gt;(b)
    
(a)-[r:<span class="hljs-type">TYPE1</span>|<span class="hljs-type">TYPE2</span>]-&gt;(b)

(a)-[:<span class="hljs-type">REL_TYPE</span>]-&gt;(b)
</code></pre><h3 id="Variable-length-pattern-matching"><a class="anchor hidden-xs" href="#Variable-length-pattern-matching" title="Variable-length-pattern-matching"><i class="fa fa-link"></i></a>Variable-length pattern matching</h3><p>Rather than describing a long path using a sequence of many node and relationship descriptions in a pattern, many relationships (and the intermediate nodes) can be described by specifying a length in the relationship description of a pattern. For example:</p><pre><code class="wrap pony hljs">(a)-[*<span class="hljs-number">2</span>]-&gt;(b) 
</code></pre><p>This describes a graph of three nodes and two relationships, all in one path (a path of length 2). This is equivalent to:</p><pre><code class="wrap pony hljs">(a)--&gt;()--&gt;(b)
</code></pre><p>A range of lengths can also be specified: such relationship patterns are called variable length relationships. For example:</p><pre><code class="wrap pony hljs">(a)-[*<span class="hljs-number">3.</span><span class="hljs-number">.5</span>]-&gt;(b)
</code></pre><p>This is a minimum length of 3, and a maximum of 5. It describes a graph of either 4 nodes and 3 relationships, 5 nodes and 4 relationships or 6 nodes and 5 relationships, all connected together in a single path.</p><p>Either bound can be omitted. For example, to describe paths of length 3 or more, use:</p><pre><code class="wrap pony hljs">(a)-[*<span class="hljs-number">3.</span>.]-&gt;(b)
</code></pre><p>To describe paths of length 5 or less, use:</p><pre><code class="wrap pony hljs">(a)-[*.<span class="hljs-number">.5</span>]-&gt;(b)
</code></pre><p>Omitting both bounds is equivalent to specifying a minimum of 1, allowing paths of any positive length to be described:</p><pre><code class="wrap pony hljs">(a)-[*]-&gt;(b)
</code></pre><h3 id="Assigning-to-path-variables"><a class="anchor hidden-xs" href="#Assigning-to-path-variables" title="Assigning-to-path-variables"><i class="fa fa-link"></i></a>Assigning to path variables</h3><p>Cypher allows paths to be named using an identifer, as exemplified by:</p><pre><code class="wrap pony hljs">p = (a)-[*<span class="hljs-number">3.</span><span class="hljs-number">.5</span>]-&gt;(b)
</code></pre><h2 id="Cypher-and-APOC"><a class="anchor hidden-xs" href="#Cypher-and-APOC" title="Cypher-and-APOC"><i class="fa fa-link"></i></a>Cypher and APOC</h2><p>Neo4j supports the APOC (Awesome Procedures on Cypher) Core library. The APOC Core library provides access to user-defined procedures and functions which extend the use of the Cypher query language into areas such as data integration, graph algorithms, and data conversion.</p><h3 id="Install-APOC-library"><a class="anchor hidden-xs" href="#Install-APOC-library" title="Install-APOC-library"><i class="fa fa-link"></i></a>Install APOC library</h3><p>The library is not installed by default to the Neo4j DBMSes. You can install it from plugins but it needs to restart the DBMS.<br>
<img src="/uploads/67ed9623d3491f4c88cbd4207.png" alt="" class="md-image md-image"></p><h2 id="Build-the-database"><a class="anchor hidden-xs" href="#Build-the-database" title="Build-the-database"><i class="fa fa-link"></i></a>Build the database</h2><p>In Neo4j Desktop, create a new project as follows:<br>
<img src="https://i.imgur.com/zHfzGM7.png" alt="" class="md-image md-image"></p><p>and add a local DBMS to the new project. Provide a name for the DBMS like <code>Social Media DBMS</code> and a password like <code>socialmedia</code>. Then, start the DBMS as follows:<br>
<img src="/uploads/67ed9623d3491f4c88cbd4205.png" alt="" class="md-image md-image"></p><p>As you can see in the following screenshot, the DBMS is active and we can access its default databases such as <code>neo4j</code> default database.</p><div class="alert alert-warning">
<p>You may get such issue which indicates that the ports for the DBMS are not free and it will change them to some free ports.<br>
<img src="/uploads/67ed9623d3491f4c88cbd4203.png" alt="" class="md-image md-image"><br>
If you are getting similar issues, please close the other services which are running on the ports 7474 and 7689.</p>
</div><p>In order to load csv files to the database, you need to add them to the <code>import</code> of the database (do not add them to the project directory) as follows:</p><p><img src="/uploads/67ed9623d3491f4c88cbd4206.png" alt="" class="md-image md-image"></p><p>After copying/pasting the csv files, the <code>import</code> directory will be as follows:<br>
<img src="https://i.imgur.com/qLTdMJO.png" alt="" class="md-image md-image"></p><p>All Neo4j DBMSes contain a built-in database called <code>system</code>, which behaves differently than all other databases. The <code>system</code> database stores system data and you can not perform graph queries against it. A fresh DBMS of Neo4j includes two databases:</p><ul>
<li><strong>system</strong> - the system database described above, containing meta-data on the DBMS and security configuration.</li>
<li><strong>neo4j</strong> - the default database, named using the config option <code>dbms.default_database=neo4j</code>.</li>
</ul><ol>
<li>Create a new database and access it.</li>
</ol><pre><code class="wrap pony hljs"><span class="hljs-type">CREATE</span> <span class="hljs-type">DATABASE</span> socialmedia

:<span class="hljs-keyword">use</span> socialmedia
</code></pre><ol start="2">
<li>Create nodes and relationships<br>
Each of the 3 CSV files needs to be loaded into Neo4j using the LOAD CSV command that reads each row of the file and then assigns the imported values to the nodes and edges of the graph.</li>
</ol><pre><code class="pony hljs">
<span class="hljs-comment">// Create Index for users on userid field</span>
<span class="hljs-type">CREATE</span> <span class="hljs-type">INDEX</span> <span class="hljs-type">FOR</span> (u:<span class="hljs-type">User</span>) <span class="hljs-type">ON</span> (u.userid)
    
<span class="hljs-comment">// Create Index for posts on postid field</span>
<span class="hljs-type">CREATE</span> <span class="hljs-type">INDEX</span> <span class="hljs-type">FOR</span> (u:<span class="hljs-type">Post</span>) <span class="hljs-type">ON</span> (u.postid)

<span class="hljs-comment">// Load users data</span>
<span class="hljs-type">LOAD</span> <span class="hljs-type">CSV</span> <span class="hljs-type">WITH</span> <span class="hljs-type">HEADERS</span> 
<span class="hljs-type">FROM</span> <span class="hljs-string">"file:///users.csv"</span> <span class="hljs-type">AS</span> row 
<span class="hljs-type">FIELDTERMINATOR</span> <span class="hljs-string">','</span>
<span class="hljs-type">CREATE</span> (
    :<span class="hljs-type">User</span> {
        userid: toInteger(row[<span class="hljs-string">'userid'</span>]), 
        name:row[<span class="hljs-string">'name'</span>], 
        surname: row[<span class="hljs-string">'surname'</span>], 
        age: toInteger(row[<span class="hljs-string">'age'</span>]), 
        timestamp: datetime({epochSeconds: toInteger(row[<span class="hljs-string">'timestamp'</span>])})}
);

<span class="hljs-comment">// Using APOC library</span>
<span class="hljs-type">CALL</span> apoc.periodic.iterate(
<span class="hljs-string">"LOAD CSV WITH HEADERS 
FROM 'file:///users.csv' AS row 
FIELDTERMINATOR ','
    RETURN row"</span>,
<span class="hljs-string">"CREATE (
    :User {
        userid: toInteger(row['userid']), 
        name:row['name'], 
        surname: row['surname'], 
        age: toInteger(row['age']), 
        timestamp: datetime({epochSeconds: toInteger(row['timestamp'])})}
)"</span>,
{batchSize:<span class="hljs-number">100</span>, parallel:<span class="hljs-literal">true</span>, concurrency: <span class="hljs-number">20</span>}
)


<span class="hljs-comment">// Load posts data</span>
<span class="hljs-type">LOAD</span> <span class="hljs-type">CSV</span> <span class="hljs-type">WITH</span> <span class="hljs-type">HEADERS</span> 
<span class="hljs-type">FROM</span> <span class="hljs-string">"file:///posts.csv"</span> <span class="hljs-type">AS</span> row 
<span class="hljs-type">FIELDTERMINATOR</span> <span class="hljs-string">','</span>
<span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>{userid:toInteger(row[<span class="hljs-string">'userid'</span>])})
<span class="hljs-type">MERGE</span> (
    :<span class="hljs-type">Post</span> {
        postid: toInteger(row[<span class="hljs-string">'postid'</span>]),  
        userid: toInteger(row[<span class="hljs-string">'userid'</span>]), 
        posttype:row[<span class="hljs-string">'posttype'</span>]
        })&lt;-[:<span class="hljs-type">ADD</span>{
    posttimestamp: datetime({epochSeconds: toInteger(row[<span class="hljs-string">'posttimestamp'</span>])})
    }]-(u);

<span class="hljs-comment">// Retrieve some nodes</span>
<span class="hljs-type">MATCH</span> (n)
<span class="hljs-type">RETURN</span> n
<span class="hljs-type">LIMIT</span> <span class="hljs-number">10</span>;

<span class="hljs-comment">// Load Friends</span>
<span class="hljs-comment">//:auto USING PERIODIC COMMIT // deprecated feature</span>
:auto <span class="hljs-type">LOAD</span> <span class="hljs-type">CSV</span> <span class="hljs-type">WITH</span> <span class="hljs-type">HEADERS</span> 
<span class="hljs-type">FROM</span> <span class="hljs-string">"file:///friends.csv"</span> <span class="hljs-type">AS</span> row 
<span class="hljs-type">FIELDTERMINATOR</span> <span class="hljs-string">','</span>
<span class="hljs-type">CALL</span> {
<span class="hljs-type">WITH</span> row
<span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>{userid:toInteger(row[<span class="hljs-string">'friend1'</span>])})
<span class="hljs-type">MATCH</span> (v:<span class="hljs-type">User</span>{userid:toInteger(row[<span class="hljs-string">'friend2'</span>])})
<span class="hljs-type">MERGE</span> (u)-[:<span class="hljs-type">FRIEND</span>]-&gt;(v)-[:<span class="hljs-type">FRIEND</span>]-&gt;(u)
} <span class="hljs-type">IN</span> <span class="hljs-type">TRANSACTIONS</span>
</code></pre><h1 id="Data-Retrieval-with-Cypher"><a class="anchor hidden-xs" href="#Data-Retrieval-with-Cypher" title="Data-Retrieval-with-Cypher"><i class="fa fa-link"></i></a>Data Retrieval with Cypher</h1><p>Cypher is Neo4js graph query language that lets you retrieve data from the graph. It is like SQL for graphs, and was inspired by SQL so it lets you focus on what data you want out of the graph (not how to go get it). It is the easiest graph language to learn by far because of its similarity to other languages and intiutiveness.</p><div class="alert alert-success">
<h2 id="Exercises"><a class="anchor hidden-xs" href="#Exercises" title="Exercises"><i class="fa fa-link"></i></a>Exercises</h2>
<ol>
<li>Who are the users who have posts?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-comment">//MATCH (u:User)-[:ADD]-(:Post)</span>
<span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)-[:<span class="hljs-type">ADD</span>]-()
<span class="hljs-type">RETURN</span> <span class="hljs-type">DISTINCT</span> u
<span class="hljs-type">LIMIT</span> <span class="hljs-number">10</span> <span class="hljs-comment">// This is added just to not display all nodes</span>
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663505.png) -->
<h2 id=""><!-- ![](/uploads/5d993a50ca40183e2b1663500.png) --></h2>
<ol start="2">
<li>What are the posts of the users?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-comment">//MATCH (p:Post)-[:ADD]-(:User)</span>
<span class="hljs-comment">//MATCH (p:Post)--()</span>
<span class="hljs-comment">//MATCH (p:Post)</span>
<span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Post</span>)--(:<span class="hljs-type">User</span>)
<span class="hljs-type">RETURN</span> p
<span class="hljs-type">LIMIT</span> <span class="hljs-number">10</span> <span class="hljs-comment">// This is added just to not display all nodes</span>
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663503.png) -->
<!-- ![](/uploads/5d993a50ca40183e2b1663501.png) -->
<!-- - -->
<ol start="3">
<li>Which posts published after 2 pm?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Post</span>)&lt;-[a:<span class="hljs-type">ADD</span>]-()
<span class="hljs-type">WHERE</span> a.posttimestamp.hour &gt; <span class="hljs-number">14</span>
<span class="hljs-type">RETURN</span> p 
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663504.png)
- -->
<!-- ![](/uploads/5d993a50ca40183e2b1663502.png) -->
<ol start="4">
<li>What is the oldest and recent dates of the posts?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Post</span>)-[a:<span class="hljs-type">ADD</span>]-()
<span class="hljs-type">RETURN</span> <span class="hljs-type">MAX</span>(a.posttimestamp), <span class="hljs-type">MIN</span>(a.posttimestamp)
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663506.png)
- -->
<ol start="5">
<li>What are the top 5 most recent posts whose type is <code>Image</code>?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Post</span>{posttype:<span class="hljs-string">'Image'</span>})-[a:<span class="hljs-type">ADD</span>]-()
<span class="hljs-type">RETURN</span> p, a
<span class="hljs-type">ORDER</span> <span class="hljs-type">BY</span> a.posttimestamp <span class="hljs-type">DESC</span>
<span class="hljs-type">LIMIT</span> <span class="hljs-number">5</span>
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663507.png)
- -->
<ol start="6">
<li>Which top 5 users who recently posted an <code>Image</code> or <code>Video</code>?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)-[a:<span class="hljs-type">ADD</span>]-&gt;(p:<span class="hljs-type">Post</span>)
<span class="hljs-type">WHERE</span> p.posttype <span class="hljs-type">IN</span> [<span class="hljs-string">'Image'</span>, <span class="hljs-string">'Video'</span>]
<span class="hljs-type">RETURN</span> u, p
<span class="hljs-type">ORDER</span> <span class="hljs-type">BY</span> a.posttimestamp <span class="hljs-type">DESC</span>
<span class="hljs-type">LIMIT</span> <span class="hljs-number">5</span>
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663508.png)
- -->
<ol start="7">
<li>What is the age of the eldest and youngest persons?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-comment">// We have negative ages</span>
<span class="hljs-comment">// Update the age of the person</span>
<span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)
<span class="hljs-type">SET</span> u.age = <span class="hljs-type">CASE</span>
           <span class="hljs-type">WHEN</span> u.age &lt; <span class="hljs-number">0</span> <span class="hljs-type">THEN</span> -u.age
           <span class="hljs-type">ELSE</span> u.age
          <span class="hljs-type">END</span>
          
<span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)
<span class="hljs-type">RETURN</span> <span class="hljs-type">MAX</span>(u.age), <span class="hljs-type">MIN</span>(u.age)
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663509.png)
- -->
<ol start="8">
<li>Who is the 2nd youngest person who published <code>Image</code> posts?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)-[:<span class="hljs-type">ADD</span>]-&gt;(p:<span class="hljs-type">Post</span>{posttype:<span class="hljs-string">'Image'</span>})
<span class="hljs-type">RETURN</span> <span class="hljs-type">DISTINCT</span> u.name, u.surname, u.age, p.posttype
<span class="hljs-type">ORDER</span> <span class="hljs-type">BY</span> u.age <span class="hljs-type">ASC</span>
<span class="hljs-type">SKIP</span> <span class="hljs-number">1</span>
<span class="hljs-type">LIMIT</span> <span class="hljs-number">1</span>
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b166350a.png)
- -->
<ol start="9">
<li>What are the posts that are published by 10 eldest people who are between 20 and 30?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Post</span>)&lt;-[:<span class="hljs-type">ADD</span>]-(u:<span class="hljs-type">User</span>)
<span class="hljs-type">WHERE</span> u.age <span class="hljs-type">IN</span> range(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>)
<span class="hljs-type">RETURN</span> p.postid, p.posttype, u.age, u.userid
<span class="hljs-type">ORDER</span> <span class="hljs-type">BY</span> u.age <span class="hljs-type">DESC</span>
<span class="hljs-type">LIMIT</span> <span class="hljs-number">10</span>
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b166350b.png)
- -->
<ol start="10">
<li>What are the friends of the youngest person? (assume that we changed the negative ages  check task 7)</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">CALL</span>{
    <span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)
    <span class="hljs-type">RETURN</span> u.userid <span class="hljs-type">AS</span> youngest
    <span class="hljs-type">ORDER</span> <span class="hljs-type">BY</span> u.age <span class="hljs-type">ASC</span>
    <span class="hljs-type">LIMIT</span> <span class="hljs-number">1</span>
}
<span class="hljs-type">WITH</span> youngest
<span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>{userid:youngest})-[:<span class="hljs-type">FRIEND</span>]-(f1:<span class="hljs-type">User</span>)
<span class="hljs-type">RETURN</span> <span class="hljs-type">DISTINCT</span> u.userid <span class="hljs-type">AS</span> user, f1.userid <span class="hljs-type">AS</span> friend
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b166350c.png)
- -->
<ol start="11">
<li>How many friends for the surname <code>Thronton</code>?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>{surname:<span class="hljs-string">'Thronton'</span>})-[:<span class="hljs-type">FRIEND</span>]-(f1:<span class="hljs-type">User</span>)
<span class="hljs-type">RETURN</span> <span class="hljs-type">COUNT</span>(<span class="hljs-type">DISTINCT</span> f1)
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b166350d.png)
- -->
<ol start="12">
<li>How many posts for each user?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)--(p:<span class="hljs-type">Post</span>)
<span class="hljs-type">RETURN</span> u.userid <span class="hljs-type">AS</span> user, <span class="hljs-type">COUNT</span>(*) <span class="hljs-type">AS</span> c
<span class="hljs-type">ORDER</span> <span class="hljs-type">BY</span> c <span class="hljs-type">DESC</span>
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b166350e.png)
- -->
<ol start="13">
<li>Who are the first 10 friends of users who posted <code>Image</code>?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (f:<span class="hljs-type">User</span>)--(u:<span class="hljs-type">User</span>)--(:<span class="hljs-type">Post</span>{posttype:<span class="hljs-string">'Image'</span>})
<span class="hljs-type">RETURN</span> <span class="hljs-type">DISTINCT</span> u.userid, u.name, u.surname, f.userid, f.name, f.surname, f.age
<span class="hljs-type">LIMIT</span> <span class="hljs-number">10</span>
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b166350f.png)
- -->
<ol start="14">
<li>How many friends of users whose age is less than 20?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)--(f1:<span class="hljs-type">User</span>)
<span class="hljs-type">WHERE</span> u.age &lt; <span class="hljs-number">20</span>
<span class="hljs-type">RETURN</span> <span class="hljs-type">COUNT</span>(<span class="hljs-type">DISTINCT</span> f1.userid) <span class="hljs-type">AS</span> c
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663510.png)
- -->
<ol start="15">
<li>How many friends of friends of users whose age is less than 20?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)-[:<span class="hljs-type">FRIEND</span>*<span class="hljs-number">2</span>]-(f2:<span class="hljs-type">User</span>)
<span class="hljs-type">WHERE</span> u.age &lt; <span class="hljs-number">20</span> <span class="hljs-type">AND</span> f2.userid &lt;&gt; u.userid
<span class="hljs-type">RETURN</span> <span class="hljs-type">COUNT</span>(<span class="hljs-type">DISTINCT</span> f2.userid) <span class="hljs-type">AS</span> c
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663511.png)
- -->
<ol start="16">
<li>How many users have more than 10 posts?</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">CALL</span>{
    <span class="hljs-type">MATCH</span> (u:<span class="hljs-type">User</span>)-[:<span class="hljs-type">ADD</span>]-(p:<span class="hljs-type">Post</span>)
    <span class="hljs-type">RETURN</span> u, <span class="hljs-type">COUNT</span>(p) <span class="hljs-type">AS</span> posts
} 
<span class="hljs-type">WITH</span> u, posts
<span class="hljs-type">MATCH</span> (v:<span class="hljs-type">User</span>{userid:u.userid})
<span class="hljs-type">WHERE</span> posts&gt;<span class="hljs-number">10</span>
<span class="hljs-type">RETURN</span> <span class="hljs-type">COUNT</span>(v)
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663512.png)
- -->
<ol start="17">
<li>What is the average number of posts published at noon and by the friends of the users whose age is more than 40? Calculate the percentage of posts.</li>
</ol>
<pre><code class="wrap pony hljs"><span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Post</span>)-[a:<span class="hljs-type">ADD</span>]-(f:<span class="hljs-type">User</span>)-[:<span class="hljs-type">FRIEND</span>]-(u:<span class="hljs-type">User</span>)
<span class="hljs-type">WHERE</span> u.age&gt;<span class="hljs-number">40</span> <span class="hljs-type">AND</span>  a.posttimestamp.hour=<span class="hljs-number">12</span>
<span class="hljs-type">WITH</span> <span class="hljs-type">COUNT</span>(p) <span class="hljs-type">AS</span> posts, f
<span class="hljs-type">RETURN</span> <span class="hljs-type">AVG</span>(posts) <span class="hljs-type">AS</span> average_posts
</code></pre>
<!-- ![](/uploads/5d993a50ca40183e2b1663514.png)
- -->
<ol start="18">
<li>What is the percentage of posts published at noon and by the friends of the users whose age is more than 40?</li>
</ol>
<pre><code class="wrap pony hljs">
<span class="hljs-type">CALL</span>{
    <span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Post</span>) <span class="hljs-type">RETURN</span> <span class="hljs-type">COUNT</span>(p) <span class="hljs-type">AS</span> all_posts
}
<span class="hljs-type">WITH</span> all_posts
<span class="hljs-type">CALL</span>{
<span class="hljs-type">MATCH</span> (p:<span class="hljs-type">Post</span>)-[a:<span class="hljs-type">ADD</span>]-(f:<span class="hljs-type">User</span>)-[:<span class="hljs-type">FRIEND</span>]-(u:<span class="hljs-type">User</span>)
<span class="hljs-type">WHERE</span> u.age&gt;<span class="hljs-number">40</span> <span class="hljs-type">AND</span>  a.posttimestamp.hour=<span class="hljs-number">12</span>
<span class="hljs-type">RETURN</span> <span class="hljs-type">COUNT</span>(<span class="hljs-type">DISTINCT</span> p) <span class="hljs-type">AS</span> posts
}
<span class="hljs-type">WITH</span> posts, all_posts
<span class="hljs-type">RETURN</span> <span class="hljs-number">100</span>*posts/all_posts + <span class="hljs-string">"%"</span> <span class="hljs-type">AS</span> posts_100
</code></pre>
</div><div class="alert alert-warning">
<p><strong>Note:</strong> You should go to the Cypher documentation to learn more. Check the links below.</p>
</div><h1 id="References"><a class="anchor hidden-xs" href="#References" title="References"><i class="fa fa-link"></i></a>References</h1><ul>
<li><a href="https://quickref.me/postgres" target="_blank" rel="noopener">PostgreSQL cheatsheet</a></li>
<li>Yasin N. Silva, Isadora Almeida, and Michell Queiroz. 2016. SQL: From Traditional Databases to Big Data. In Proceedings of the 47th ACM Technical Symposium on Computing Science Education (SIGCSE '16). Association for Computing Machinery, New York, NY, USA, 413418. <a href="https://doi.org/10.1145/2839509.2844560" target="_blank" rel="noopener">https://doi.org/10.1145/2839509.2844560</a></li>
<li><a href="https://www.postgresqltutorial.com" target="_blank" rel="noopener">Comprehensive PostgreSQL Tutorial</a></li>
<li><a href="https://www.postgresql.org/docs/9.2/app-psql.html" target="_blank" rel="noopener">psql 9.2 Documentation</a></li>
<li><a href="https://neo4j.com/docs/cypher-manual/4.4/" target="_blank" rel="noopener">Cypher Manual</a></li>
<li><a href="https://neo4j.com/docs/cypher-cheat-sheet/5/neo4j-community/" target="_blank" rel="noopener">Cypher cheatsheet</a></li>
<li><a href="https://neo4j.com/docs/apoc/current/introduction/" target="_blank" rel="noopener">Neo4j APOC Library</a></li>
</ul></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li class=""><a href="#Lab-3---Data-Retrieval-with-Cypher" title="Lab 3 - Data Retrieval with Cypher">Lab 3 - Data Retrieval with Cypher</a><ul class="nav">
<li class=""><a href="#Dataset" title="Dataset">Dataset</a></li>
<li class=""><a href="#Neo4j-Desktop" title="Neo4j Desktop">Neo4j Desktop</a></li>
</ul>
</li>
<li class=""><a href="#Agenda" title="Agenda">Agenda</a></li>
<li class=""><a href="#Prerequisites" title="Prerequisites">Prerequisites</a></li>
<li class=""><a href="#Objectives" title="Objectives">Objectives</a></li>
<li class=""><a href="#Introduction" title="Introduction">Introduction</a></li>
<li class=""><a href="#Dataset-Descripion" title="Dataset Descripion">Dataset Descripion</a></li>
<li class=""><a href="#Build-the-relational-database" title="Build the relational database">Build the relational database</a><ul class="nav">
<li class=""><a href="#Fix-Friends-table" title="Fix Friends table">Fix Friends table</a></li>
</ul>
</li>
<li class=""><a href="#Data-Retrieval-using-SQL" title="Data Retrieval using SQL">Data Retrieval using SQL</a><ul class="nav">
<li class=""><a href="#Data-Retrieval-from-a-single-table" title="Data Retrieval from a single table">Data Retrieval from a single table</a></li>
<li class=""><a href="#Data-Retrieval-from-multiple-tables-Joining-tables" title="Data Retrieval from multiple tables (Joining tables)">Data Retrieval from multiple tables (Joining tables)</a></li>
<li class=""><a href="#Aggregation-and-grouping" title="Aggregation and grouping">Aggregation and grouping</a></li>
</ul>
</li>
<li class=""><a href="#Graph-databases" title="Graph databases">Graph databases</a><ul class="nav">
<li class=""><a href="#Download-and-Install-Neo4j" title="Download and Install Neo4j">Download and Install Neo4j</a></li>
</ul>
</li>
<li class=""><a href="#Cypher" title="Cypher">Cypher</a><ul class="nav">
<li class=""><a href="#Key-Neo4j-terminology" title="Key Neo4j terminology">Key Neo4j terminology</a></li>
<li class=""><a href="#Core-concepts" title="Core concepts">Core concepts</a></li>
<li class=""><a href="#Patterns" title="Patterns">Patterns</a><ul class="nav">
<li class=""><a href="#Node-patterns" title="Node patterns">Node patterns</a></li>
<li class=""><a href="#Relationship-patterns" title="Relationship patterns">Relationship patterns</a></li>
<li class=""><a href="#Path-patterns" title="Path patterns">Path patterns</a></li>
<li class=""><a href="#Path-pattern-matching" title="Path pattern matching">Path pattern matching</a></li>
</ul>
</li>
<li class=""><a href="#Property-types" title="Property types">Property types</a></li>
<li class=""><a href="#Structural-types" title="Structural types">Structural types</a></li>
<li class=""><a href="#Composite-types" title="Composite types">Composite types</a></li>
<li class=""><a href="#How-to-define-a-variable" title="How to define a variable">How to define a variable</a></li>
<li class=""><a href="#Operators" title="Operators">Operators</a><ul class="nav">
<li class=""><a href="#DISTINCT-aggregation-operator" title="DISTINCT (aggregation operator)">DISTINCT (aggregation operator)</a></li>
<li class=""><a href="#Property-operators" title="Property operators">Property operators</a></li>
<li class=""><a href="#Mathemtical-operators" title="Mathemtical operators">Mathemtical operators</a></li>
<li class=""><a href="#Comparison-operators" title="Comparison operators">Comparison operators</a></li>
<li class=""><a href="#Boolean-operators" title="Boolean operators">Boolean operators</a></li>
<li class=""><a href="#String-operators" title="String operators">String operators</a></li>
</ul>
</li>
<li class=""><a href="#Patterns1" title="Patterns">Patterns</a><ul class="nav">
<li class=""><a href="#Patterns-for-nodes" title="Patterns for nodes">Patterns for nodes</a></li>
<li class=""><a href="#Patterns-for-related-nodes" title="Patterns for related nodes">Patterns for related nodes</a></li>
<li class=""><a href="#Patterns-for-labels" title="Patterns for labels">Patterns for labels</a></li>
<li class=""><a href="#Specifying-properties" title="Specifying properties">Specifying properties</a></li>
<li class=""><a href="#Patterns-for-relationships" title="Patterns for relationships">Patterns for relationships</a></li>
<li class=""><a href="#Variable-length-pattern-matching" title="Variable-length pattern matching">Variable-length pattern matching</a></li>
<li class=""><a href="#Assigning-to-path-variables" title="Assigning to path variables">Assigning to path variables</a></li>
</ul>
</li>
<li class=""><a href="#Cypher-and-APOC" title="Cypher and APOC">Cypher and APOC</a><ul class="nav">
<li class=""><a href="#Install-APOC-library" title="Install APOC library">Install APOC library</a></li>
</ul>
</li>
<li class=""><a href="#Build-the-database" title="Build the database">Build the database</a></li>
</ul>
</li>
<li class=""><a href="#Data-Retrieval-with-Cypher" title="Data Retrieval with Cypher">Data Retrieval with Cypher</a></li>
<li><a href="#References" title="References">References</a></li>
</ul>
</div><div class="toc-menu" style="">
    <a class="expand-toggle expand-all" href="#">Expand all</a>
    <a class="expand-toggle collapse-all" href="#" style="display: none;">Collapse all</a>
    <a class="back-to-top" href="#">Back to top</a>
    <a class="go-to-bottom" href="#">Go to bottom</a>
</div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;"  >
        <div class="toc"><ul class="nav">
<li class=""><a href="#Lab-3---Data-Retrieval-with-Cypher" title="Lab 3 - Data Retrieval with Cypher">Lab 3 - Data Retrieval with Cypher</a><ul class="nav">
<li class=""><a href="#Dataset" title="Dataset">Dataset</a></li>
<li class=""><a href="#Neo4j-Desktop" title="Neo4j Desktop">Neo4j Desktop</a></li>
</ul>
</li>
<li class=""><a href="#Agenda" title="Agenda">Agenda</a></li>
<li class=""><a href="#Prerequisites" title="Prerequisites">Prerequisites</a></li>
<li class=""><a href="#Objectives" title="Objectives">Objectives</a></li>
<li class=""><a href="#Introduction" title="Introduction">Introduction</a></li>
<li class=""><a href="#Dataset-Descripion" title="Dataset Descripion">Dataset Descripion</a></li>
<li class=""><a href="#Build-the-relational-database" title="Build the relational database">Build the relational database</a><ul class="nav">
<li class=""><a href="#Fix-Friends-table" title="Fix Friends table">Fix Friends table</a></li>
</ul>
</li>
<li class=""><a href="#Data-Retrieval-using-SQL" title="Data Retrieval using SQL">Data Retrieval using SQL</a><ul class="nav">
<li class=""><a href="#Data-Retrieval-from-a-single-table" title="Data Retrieval from a single table">Data Retrieval from a single table</a></li>
<li class=""><a href="#Data-Retrieval-from-multiple-tables-Joining-tables" title="Data Retrieval from multiple tables (Joining tables)">Data Retrieval from multiple tables (Joining tables)</a></li>
<li class=""><a href="#Aggregation-and-grouping" title="Aggregation and grouping">Aggregation and grouping</a></li>
</ul>
</li>
<li class=""><a href="#Graph-databases" title="Graph databases">Graph databases</a><ul class="nav">
<li class=""><a href="#Download-and-Install-Neo4j" title="Download and Install Neo4j">Download and Install Neo4j</a></li>
</ul>
</li>
<li class=""><a href="#Cypher" title="Cypher">Cypher</a><ul class="nav">
<li class=""><a href="#Key-Neo4j-terminology" title="Key Neo4j terminology">Key Neo4j terminology</a></li>
<li class=""><a href="#Core-concepts" title="Core concepts">Core concepts</a></li>
<li class=""><a href="#Patterns" title="Patterns">Patterns</a><ul class="nav">
<li class=""><a href="#Node-patterns" title="Node patterns">Node patterns</a></li>
<li class=""><a href="#Relationship-patterns" title="Relationship patterns">Relationship patterns</a></li>
<li class=""><a href="#Path-patterns" title="Path patterns">Path patterns</a></li>
<li class=""><a href="#Path-pattern-matching" title="Path pattern matching">Path pattern matching</a></li>
</ul>
</li>
<li class=""><a href="#Property-types" title="Property types">Property types</a></li>
<li class=""><a href="#Structural-types" title="Structural types">Structural types</a></li>
<li class=""><a href="#Composite-types" title="Composite types">Composite types</a></li>
<li class=""><a href="#How-to-define-a-variable" title="How to define a variable">How to define a variable</a></li>
<li class=""><a href="#Operators" title="Operators">Operators</a><ul class="nav">
<li class=""><a href="#DISTINCT-aggregation-operator" title="DISTINCT (aggregation operator)">DISTINCT (aggregation operator)</a></li>
<li class=""><a href="#Property-operators" title="Property operators">Property operators</a></li>
<li class=""><a href="#Mathemtical-operators" title="Mathemtical operators">Mathemtical operators</a></li>
<li class=""><a href="#Comparison-operators" title="Comparison operators">Comparison operators</a></li>
<li class=""><a href="#Boolean-operators" title="Boolean operators">Boolean operators</a></li>
<li class=""><a href="#String-operators" title="String operators">String operators</a></li>
</ul>
</li>
<li class=""><a href="#Patterns1" title="Patterns">Patterns</a><ul class="nav">
<li class=""><a href="#Patterns-for-nodes" title="Patterns for nodes">Patterns for nodes</a></li>
<li class=""><a href="#Patterns-for-related-nodes" title="Patterns for related nodes">Patterns for related nodes</a></li>
<li class=""><a href="#Patterns-for-labels" title="Patterns for labels">Patterns for labels</a></li>
<li class=""><a href="#Specifying-properties" title="Specifying properties">Specifying properties</a></li>
<li class=""><a href="#Patterns-for-relationships" title="Patterns for relationships">Patterns for relationships</a></li>
<li class=""><a href="#Variable-length-pattern-matching" title="Variable-length pattern matching">Variable-length pattern matching</a></li>
<li class=""><a href="#Assigning-to-path-variables" title="Assigning to path variables">Assigning to path variables</a></li>
</ul>
</li>
<li class=""><a href="#Cypher-and-APOC" title="Cypher and APOC">Cypher and APOC</a><ul class="nav">
<li class=""><a href="#Install-APOC-library" title="Install APOC library">Install APOC library</a></li>
</ul>
</li>
<li class=""><a href="#Build-the-database" title="Build the database">Build the database</a></li>
</ul>
</li>
<li class=""><a href="#Data-Retrieval-with-Cypher" title="Data Retrieval with Cypher">Data Retrieval with Cypher</a></li>
<li><a href="#References" title="References">References</a></li>
</ul>
</div><div class="toc-menu" style="">
    <a class="expand-toggle expand-all" href="#">Expand all</a>
    <a class="expand-toggle collapse-all" href="#" style="display: none;">Collapse all</a>
    <a class="back-to-top" href="#">Back to top</a>
    <a class="go-to-bottom" href="#">Go to bottom</a>
</div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.0/js/bootstrap.min.js" integrity="sha256-kJrlY+s09+QoWjpkOrXXwhxeaoDz9FW5SaxF8I0DibQ=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
